<!-- https://github.com/nhn/tui.calendar -->
<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>[[#{app.name}]] - Presensi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"
        integrity="sha512-mSYUmp1HYZDFaVKK//63EcZq4iFWFjxSL+Z3T/aCt4IO9Cejm03q3NKKYN6pFQzY0SBOr8h+eCIAZHPXcpZaNw=="
        crossorigin="anonymous" />
    <link th:href="@{/styles/app.css}" rel="stylesheet" />
</head>

<body>
    <header th:replace="~{fragment/header :: header}">Header</header>
    <div class="container">
        <div class="row pb-2">
            <div class="col-md-6">
                <h5 class="align-text-bottom">HARI INI</h5>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-success"><i class="las la-download"></i> Download</button>
            </div>
        </div>
        <div class="row row-cols-1 row-cols-md-5 g-5">
            <div class="col">
                <div class="card h-60">
                    <div class="card-header text-center text-light" style="background-color: #08990D;">
                        <i class="las la-history la-3x"></i><br />
                        <span>LOGIN</span>
                    </div>
                    <div class="card-body text-center">
                        <p class="card-text">
                        <h3><span th:text="${totalLogin}"></span>/<span class="h5 text-muted"
                                th:text="${totalEmployee}"></span> orang</h3>
                        </p>
                    </div>
                    <div class="card-footer text-end" style="background-color: #83CC86;">
                        <a th:href="@{/auth/session(filter='latest')}" class="flat-link"> <small>Detail <i class="las la-arrow-right"></i></small></a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-60">
                    <div class="card-header text-center text-light" style="background-color: #0983E7;">
                        <i class="las la-door-open la-3x"></i><br />
                        <span>PRESENSI MASUK</span>
                    </div>
                    <div class="card-body text-center">
                        <p class="card-text">
                        <h3><span th:text="${totalClockIn}"></span>/<span class="h5 text-muted"
                                th:text="${totalEmployee}"></span> orang</h3>
                        </p>
                    </div>
                    <div class="card-footer text-end" style="background-color: #84C1F3;">
                        <small>Detail <i class="las la-arrow-right"></i></small>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-60">
                    <div class="card-header text-center text-light" style="background-color: #5A3F8C;">
                        <i class="las la-door-closed la-3x"></i><br />
                        <span>PRESENSI PULANG</span>
                    </div>
                    <div class="card-body text-center">
                        <p class="card-text">
                        <h3><span th:text="${totalClockOut}"></span>/<span class="h5 text-muted"
                                th:text="${totalEmployee}"></span> orang</h3>
                        </p>
                    </div>
                    <div class="card-footer text-end" style="background-color: rgba(90, 63, 140, 0.5);">
                        <small>Detail <i class="las la-arrow-right"></i></small>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-60">
                    <div class="card-header text-center text-light" style="background-color: #FFB800;">
                        <i class="las la-id-card-alt la-3x"></i><br />
                        <span>DISPENSASI</span>
                    </div>
                    <div class="card-body text-center">
                        <p class="card-text">
                        <h3><span th:text="${totalDispensation}"></span>/<span class="h5 text-muted"
                                th:text="${totalEmployee}"></span> orang</h3>
                        </p>
                    </div>
                    <div class="card-footer text-end" style="background-color: rgba(255, 184, 0, 0.5);">
                        <a th:href="@{/dispensation}" class="flat-link"> <small>Detail <i class="las la-arrow-right"></i></small></a>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card h-60">
                    <div class="card-header text-center text-light" style="background-color: #FC4D4D;">
                        <i class="las la-map-pin la-3x"></i><br />
                        <span>FAKE LOCATOR</span>
                    </div>
                    <div class="card-body text-center">
                        <p class="card-text">
                        <h3><span th:text="${totalFakeLocator}"></span>/<span class="h5 text-muted"
                                th:text="${totalEmployee}"></span> orang</h3>
                        </p>
                    </div>
                    <div class="card-footer text-end" style="background-color: rgba(252, 77, 77, 0.5);">
                        <small>Detail <i class="las la-arrow-right"></i></small>
                    </div>
                </div>
            </div>
        </div>
        <form>
            <div class="row py-3">
                <div class="col-md-5">
                    <h5>LOG PRESENSI</h5>
                </div>
                <div class="col-md-4">
                    <input type="hidden" id="division-id" th:value="${division}" />
                    <input id="search-name" type="text" class="form-control" name="name" placeholder="Cari nama..."
                        autocomplete="off" aria-label="cari nama">
                </div>
                <div class="col-md-3">
                    <input id="date-selection" type="text" class="form-control text-center" data-provide="datepicker"
                        th:value="${dateDisplay}">
                </div>
            </div>
        </form>
        <div class="row" style="padding: 0 4px;">
            <ul class="nav nav-pills px-2">
                <li class="nav-item">
                    <a class="nav-link" th:classappend="${division == null ? 'active':''}" aria-current="page"
                        th:href="@{/absence(date=${date})}">Semua</a>
                </li>
                <th:block th:each="map: ${divisions}">
                    <li class="nav-item">
                        <a class="nav-link" th:classappend="${division == map.get('id') ? 'active':''}"
                            th:href="@{/absence(date=${date}, division=${map.get('id')})}"
                            th:text="${map.get('code')}"></a>
                    </li>
                </th:block>
            </ul>
        </div>
        <div class="row py-2">
            <div class="table-responsive">
                <table class="table table-borderless bg-light">
                    <thead class="text-white" style="background-color: #0983E7;">
                        <tr>
                            <th rowspan="2" class="text-center align-middle" scope="col" th:text="#{no}"></th>
                            <th rowspan="2" class="text-center align-middle" scope="col">Nama Pegawai</th>
                            <th colspan="3" class="text-center" scope="col">Masuk</th>
                            <th colspan="3" class="text-center" scope="col">Pulang</th>
                            <th rowspan="2" class="text-center align-middle" scope="col">Durasi Kerja</th>
                            <th rowspan="2" class="text-center align-middle" scope="col">Status</th>
                            <th rowspan="2" class="text-center align-middle" scope="col">Fake Locator</th>
                        </tr>
                        <tr>
                            <th class="text-center" scope="col">Waktu</th>
                            <th class="text-center" scope="col">IP Address</th>
                            <th class="text-center" scope="col">Terlambat Masuk</th>
                            <th class="text-center" scope="col">Waktu</th>
                            <th class="text-center" scope="col">IP Address</th>
                            <th class="text-center" scope="col">Cepat Pulang</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="row: ${data}" th:if="${data.numberOfElements > 0}">
                            <td class="text-center" th:text="${rowStat.count + startIndex}" />
                            <td class="text-start">
                                <a th:if="${row.fullName != null}" th:href="@{/absence/user(id=${row.userId})}"
                                    class="flat-link" th:text="${row.fullName}"></a>
                                <a th:unless="${row.fullName != null}" th:href="@{/absence/user(id=${row.userId})}"
                                    class="flat-link" th:text="${row.email}"></a>
                            </td>
                            <td class="text-center"
                                th:text="${row.clockInTime != null ?  #temporals.format(row.clockInTime, 'HH:mm:ss') : '-' }" />
                            <td class="text-center"
                                th:text="${row.clockInIpAddress != null ? row.clockInIpAddress : '-'}" />
                            <td class="text-center" th:text="${row.lateDisplay != null ? row.lateDisplay : '-'}">-</td>
                            <td class="text-center"
                                th:text="${row.clockOutTime != null ?  #temporals.format(row.clockOutTime, 'HH:mm:ss') : '-'}" />
                            <td class="text-center"
                                th:text="${row.clockOutIpAddress != null ? row.clockOutIpAddress : '-'}" />
                            <td class="text-center" th:text="${row.earlyDisplay != null ? row.earlyDisplay : '-'}">-</td>
                            <td class="text-center"
                                th:text="${row.workingDisplay != null ? row.workingDisplay : '-'}">-</td>
                            <td class="text-center" th:text="${row.status != null ? row.status : '-'}">Status</td>
                            <td class="text-center text-danger" th:if="${row.isFakeLocator==true}">On</td>
                            <td class="text-center" th:unless="${row.isFakeLocator==true}">-</td>

                        </tr>
                        <tr th:unless="${data.numberOfElements > 0}">
                            <td colspan="11" class="text-center">Tidak ada data</td>
                        </tr>
                    </tbody>
                </table>
                <nav aria-label="Page navigation example" th:if="${data.totalPages > 1}">
                    <ul class="pagination pagination-sm" th:classappend="justify-content-end">

                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <th:block th:if="${division}">
                                <a class="page-link"
                                    th:href="@{/absence(date=${date}, page=${currentPage-1}, division=${division})}"
                                    aria-label="Previous" title="Previous Page" data-toggle="tooltip">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </th:block>
                            <th:block th:unless="${division}">
                                <a class="page-link" th:href="@{/absence(date=${date}, page=${currentPage-1})}"
                                    aria-label="Previous" title="Previous Page" data-toggle="tooltip">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </th:block>
                        </li>
                        <th:block th:each="pageNumber : ${pages}">
                            <li class="page-item active" th:if="${pageNumber==currentPage+1}">
                                <a href="#" th:classappend="page-link">
                                    <span aria-hidden="true" th:text="${pageNumber}"></span>
                                </a>
                            </li>
                            <li class="page-item disabled" th:if="${pageNumber} == -1">
                                <a class="page-link" href="#">...</a>
                            </li>
                            <li class="page-item" th:if="${pageNumber} != -1 and ${pageNumber} != ${currentPage+1}">
                                <th:block th:if="${division}">
                                    <a th:href="@{/absence(date=${date}, page=${pageNumber-1}, division=${division})}"
                                        th:classappend="page-link">
                                        <span aria-hidden="true" th:text="${pageNumber}"></span>
                                    </a>
                                </th:block>
                                <th:block th:unless="${division}">
                                    <a th:href="@{/absence(date=${date}, page=${pageNumber-1})}"
                                        th:classappend="page-link">
                                        <span aria-hidden="true" th:text="${pageNumber}"></span>
                                    </a>
                                </th:block>
                            </li>
                        </th:block>
                        <li class="page-item" th:classappend="${currentPage + 1 == data.totalPages} ? 'disabled'">
                            <th:block th:if="${division}">
                                <a class="page-link"
                                    th:href="@{/absence(date=${date}, page=${currentPage+1}, division=${division})}"
                                    aria-label="Next" title="Next Page" data-toggle="tooltip">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </th:block>
                            <th:block th:unless="${division}">
                                <a class="page-link" th:href="@{/absence(date=${date}, page=${currentPage+1})}"
                                    aria-label="Next" title="Next Page" data-toggle="tooltip">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </th:block>
                        </li>

                    </ul>
                </nav>
            </div>
        </div>

        <footer th:insert="~{fragment/footer :: footer}">Footer</footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"
        integrity="sha512-T/tUfKSV1bihCnd+MxKD0Hm1uBBroVYBOYSk1knyvQ9VyZJpc/ALb4P0r6ubwVPSGB2GvjeoMAJJImBG12TiaQ=="
        crossorigin="anonymous"></script>
    <script th:src="@{/scripts/autocomplete.js}"></script>
    <script th:src="@{/scripts/app.js}"></script>

    <script>
        var nameAutocomplete;
        (function () {
            nameAutocomplete = new Autocomplete(document.getElementById('search-name'), {
                data: [],
                maximumItems: 5,
                treshold: 1,
                onSelectItem: ({ label, value }) => {
                    console.log("user selected:", label, value);
                    window.location.href = '/absence/user?id=' + value;
                }
            });
            $('#search-name').keyup(function (e) {
                if ($('#search-name').val().length >= 1 && $('#search-name').val() != "") {
                    console.log
                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        url: "/employee/search",
                        data: 'name=' + $('#search-name').val(),
                        success: function (data) {
                            nameAutocomplete.setData(data);
                        }
                    });
                }
            });

            $('#date-selection').datepicker({
                todayHighlight: true,
                language: 'id',
                autoclose: true,
                todayBtn: "linked",

            }).on('changeDate', function (e) {
                console.log(e.date);
                var division = $('#division-id').val();
                if (division != null && division != "")
                    window.location.href = '/absence?date=' + e.date.toLocaleDateString("fr-CA") + "&division=" + division;
                else
                    window.location.href = '/absence?date=' + e.date.toLocaleDateString("fr-CA");
            });
        })();

    </script>
</body>

</html>