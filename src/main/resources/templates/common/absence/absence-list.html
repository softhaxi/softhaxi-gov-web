<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/authenticated}">

<head th:fragment="common_head(meta,title,links,script)">
    <title>[[#{app.name}]]</title>
    <link th:href="@{/styles/absence.css}" rel="stylesheet" />
</head>

<body class="bg-light">
    <header>
    </header>
    <div layout:fragment="content">
        <div class="absence-today">
            <div class="row title">
                <h3 th:text="#{label.absence.today}"></h3>
            </div>
            <div class="justify-content-md-center grid-container my-2 row">
                <div class="login absence-grid-item">
                    <div class="header py-3">
                        <div class="text-center py-2">
                            <svg width="36" height="36" viewBox="0 0 38 38" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M16.9167 10.6667V21.0833L25.7708 26.3333L27.375 23.6667L20.0417 19.3125V10.6667H16.9167ZM37.75 14.8333V0.25L32.25 5.75C28.875 2.35417 24.1875 0.25 19 0.25C8.64583 0.25 0.25 8.64583 0.25 19C0.25 29.3542 8.64583 37.75 19 37.75C29.3542 37.75 37.75 29.3542 37.75 19H33.5833C33.5833 27.0417 27.0417 33.5833 19 33.5833C10.9583 33.5833 4.41667 27.0417 4.41667 19C4.41667 10.9583 10.9583 4.41667 19 4.41667C23.0208 4.41667 26.6667 6.0625 29.3125 8.6875L23.1667 14.8333H37.75Z"
                                    fill="white" />
                            </svg>
                        </div>
                        <span th:text=#{label.absence.today.login}></span>
                    </div>
                    <div class="content text-center py-3"><span class="actual-value" th:text="${login}"></span>/<span
                            class="expected-value" th:text="${totalEmployee}"></span> orang</div>
                    <div class="footer">
                        <a th:href="@{/employment/activity?action=log.in}" class="py-2">
                            <span th:text="#{label.absence.detail}" class="grid-item"></span>
                            <i class="fa fa-arrow-right text-center grid-item"></i>
                        </a>
                    </div>
                </div>
                <div class="locator absence-grid-item">
                    <div class="header py-3">
                        <div class="text-center py-2">
                                <svg width="30" height="42" viewBox="0 0 30 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0001 0.166504C21.8959 0.166504 27.5001 5.77067 27.5001 12.6665C27.5001 22.0415 15.0001 35.5832 15.0001 35.5832C15.0001 35.5832 2.5001 22.0415 2.5001 12.6665C2.5001 5.77067 8.10427 0.166504 15.0001 0.166504ZM29.5834 37.6665H0.416748V41.8332H29.5834V37.6665ZM6.66675 12.6665C6.66675 8.06233 10.3959 4.33317 15.0001 4.33317C19.6042 4.33317 23.3334 8.06233 23.3334 12.6665C23.3334 17.104 19.0001 24.0415 15.0001 29.1457C11.0001 24.0623 6.66675 17.104 6.66675 12.6665ZM10.8334 12.6665C10.8334 10.3748 12.7084 8.49984 15.0001 8.49984C17.2917 8.49984 19.1667 10.3748 19.1667 12.6665C19.1667 14.9582 17.3126 16.8332 15.0001 16.8332C12.7084 16.8332 10.8334 14.9582 10.8334 12.6665Z" fill="white"/>
                                    </svg>
                                    
                        </div>
                        <span th:text=#{label.absence.today.fake.locator}></span>
                    </div>
                    <div class="content text-center py-3"><span class="actual-value" th:text="${totalFakeLocator}"></span>/<span
                            class="expected-value" th:text="${totalEmployee}"></span> orang</div>
                    <div class="footer">
                        <a href="#" class="py-2">
                            <span th:text="#{label.absence.detail}" class="grid-item"></span>
                            <i class="fa fa-arrow-right text-center grid-item"></i>
                        </a>
                    </div>
                </div>
                <div class="presensi-in absence-grid-item">
                    <div class="header py-3">
                            <div class="text-center py-2">
                                    <svg width="38" height="44" viewBox="0 0 38 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.41667 0.125H33.5833C35.875 0.125 37.75 2 37.75 4.29167V33.4583C37.75 35.75 35.875 37.625 33.5833 37.625H25.25L19 43.875L12.75 37.625H4.41667C2.10417 37.625 0.25 35.75 0.25 33.4583V4.29167C0.25 2 2.10417 0.125 4.41667 0.125ZM23.5208 33.4583H33.5833V4.29166H4.41668V33.4583H14.4792L15.6875 34.6667L19 37.9792L22.2917 34.6875L23.5208 33.4583ZM19 18.875C22.4375 18.875 25.25 16.0625 25.25 12.625C25.25 9.1875 22.4375 6.375 19 6.375C15.5625 6.375 12.75 9.1875 12.75 12.625C12.75 16.0625 15.5625 18.875 19 18.875ZM21.0833 12.625C21.0833 11.4792 20.1458 10.5417 19 10.5417C17.8542 10.5417 16.9167 11.4792 16.9167 12.625C16.9167 13.7708 17.8542 14.7083 19 14.7083C20.1458 14.7083 21.0833 13.7708 21.0833 12.625ZM31.5 28.4167C31.5 23.2083 23.2292 20.9583 19 20.9583C14.7708 20.9583 6.5 23.2083 6.5 28.4167V31.375H31.5V28.4167ZM19 25.125C16.3125 25.125 13.2083 26.1458 11.6666 27.2083H26.3333C24.7916 26.1458 21.6875 25.125 19 25.125Z" fill="white"/>
                                        </svg>
                                        
                                        </div>
                                <span th:text=#{label.absence.today.presensi.in}></span></div>
                    <div class="content text-center py-3"><span class="actual-value" th:text="${inPresensi}"></span>/<span
                            class="expected-value" th:text="${totalEmployee}"></span> orang</div>
                    <div class="footer">
                        <a th:href="@{/employment/activity?action=clock.in}" class="py-2">
                            <span th:text="#{label.absence.detail}" class="grid-item"></span>
                            <i class="fa fa-arrow-right text-center grid-item"></i>
                        </a>
                    </div>
                </div>
                <div class="presensi-out absence-grid-item">
                    <div class="header py-3">
                            <div class="text-center py-2">
                                    <svg width="30" height="42" viewBox="0 0 30 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0001 0.166504C21.8959 0.166504 27.5001 5.77067 27.5001 12.6665C27.5001 22.0415 15.0001 35.5832 15.0001 35.5832C15.0001 35.5832 2.5001 22.0415 2.5001 12.6665C2.5001 5.77067 8.10427 0.166504 15.0001 0.166504ZM29.5834 37.6665H0.416748V41.8332H29.5834V37.6665ZM6.66675 12.6665C6.66675 8.06233 10.3959 4.33317 15.0001 4.33317C19.6042 4.33317 23.3334 8.06233 23.3334 12.6665C23.3334 17.104 19.0001 24.0415 15.0001 29.1457C11.0001 24.0623 6.66675 17.104 6.66675 12.6665ZM10.8334 12.6665C10.8334 10.3748 12.7084 8.49984 15.0001 8.49984C17.2917 8.49984 19.1667 10.3748 19.1667 12.6665C19.1667 14.9582 17.3126 16.8332 15.0001 16.8332C12.7084 16.8332 10.8334 14.9582 10.8334 12.6665Z" fill="white"/>
                                        </svg>                                        
                                </div>
                                <span th:text=#{label.absence.today.presensi.out}></span></div>
                    <div class="content text-center py-3"><span class="actual-value" th:text="${outPresensi}"></span>/<span
                            class="expected-value" th:text="${totalEmployee}"></span> orang</div>
                    <div class="footer">
                        <a th:href="@{/employment/activity?action=clock.out}" class="py-2">
                            <span th:text="#{label.absence.detail}" class="grid-item"></span>
                            <i class="fa fa-arrow-right text-center grid-item"></i>
                        </a>
                    </div>
                </div>
                <div class="dispensasi absence-grid-item">
                    <div class="header py-3">
                            <div class="text-center py-2">
                                    <svg width="38" height="44" viewBox="0 0 38 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.41667 0.125H33.5833C35.875 0.125 37.75 2 37.75 4.29167V33.4583C37.75 35.75 35.875 37.625 33.5833 37.625H25.25L19 43.875L12.75 37.625H4.41667C2.10417 37.625 0.25 35.75 0.25 33.4583V4.29167C0.25 2 2.10417 0.125 4.41667 0.125ZM23.5208 33.4583H33.5833V4.29166H4.41668V33.4583H14.4792L15.6875 34.6667L19 37.9792L22.2917 34.6875L23.5208 33.4583ZM19 18.875C22.4375 18.875 25.25 16.0625 25.25 12.625C25.25 9.1875 22.4375 6.375 19 6.375C15.5625 6.375 12.75 9.1875 12.75 12.625C12.75 16.0625 15.5625 18.875 19 18.875ZM21.0833 12.625C21.0833 11.4792 20.1458 10.5417 19 10.5417C17.8542 10.5417 16.9167 11.4792 16.9167 12.625C16.9167 13.7708 17.8542 14.7083 19 14.7083C20.1458 14.7083 21.0833 13.7708 21.0833 12.625ZM31.5 28.4167C31.5 23.2083 23.2292 20.9583 19 20.9583C14.7708 20.9583 6.5 23.2083 6.5 28.4167V31.375H31.5V28.4167ZM19 25.125C16.3125 25.125 13.2083 26.1458 11.6666 27.2083H26.3333C24.7916 26.1458 21.6875 25.125 19 25.125Z" fill="white"/>
                                        </svg>
                                </div><span th:text=#{label.absence.today.dispensasi}></span></div>
                    <div class="content text-center py-3"><span class="actual-value" th:text="${dispensasi}"></span>/<span
                            class="expected-value" th:text="${totalEmployee}"></span> orang</div>
                    <div class="footer">
                        <a href="#" class="py-2">
                            <span th:text="#{label.absence.detail}" class="grid-item"></span>
                            <i class="fa fa-arrow-right text-center grid-item"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="presensi-log my-5">
            <div class="row">
                <div class="title col-sm-4">
                    <h3 th:text="#{label.absence.presensi.log}"></h3>
                </div>
                <div class="col-sm-4" style="position: relative">
                    <form class="search" action="#" th:object="${sysParam}" method="POST" id="search" >
                        <input autocomplete="off" type="text" placeholder="Search.." name="username" id="input-search" class="dropdown-toggle">
                        <button type="button" id="btn-search"><i class="fa fa-search"  id="icn-btn-search"></i></button>
                    </form>
                    <div class="dropdown dropdown-username" id="dropdown-username" style="position: absolute">
                        <ul class="list-unstyled" id="list-username" aria-labelledby="dropdownMenuButton2">
                        </ul>
                    </div>
                </div>
                <!-- 2021-01-21 15:53:26.587+08 -->
                <div class="title col-sm-3">
                    <div class="dropdown float-end">
                        <button class="btn dropdown-btn-white dropdown-toggle" type="button" id="month-button"
                            data-bs-toggle="dropdown" aria-expanded="false" th:value="${month}">
                            January
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="presensi-month">
                            <li id="1"><a class="dropdown-item" href="#">January</a></li>
                            <li id="2"><a class="dropdown-item" href="#">February</a></li>
                            <li id="3"><a class="dropdown-item" href="#">March</a></li>
                            <li id="4"><a class="dropdown-item" href="#">April</a></li>
                            <li id="5"><a class="dropdown-item" href="#">May</a></li>
                            <li id="6"><a class="dropdown-item" href="#">June</a></li>
                            <li id="7"><a class="dropdown-item" href="#">July</a></li>
                            <li id="8"><a class="dropdown-item" href="#">August</a></li>
                            <li id="9"><a class="dropdown-item" href="#">September</a></li>
                            <li id="10"><a class="dropdown-item" href="#">October</a></li>
                            <li id="11"><a class="dropdown-item" href="#">November</a></li>
                            <li id="12"><a class="dropdown-item" href="#">December</a></li>
                        </ul>
                    </div>
                </div>
                <div class="title col-sm-1">
                    <div class="dropdown float-end">
                        <button class="btn dropdown-btn-white dropdown-toggle" type="button" id="year-button"
                            data-bs-toggle="dropdown" aria-expanded="false" th:value="${year}">
                            2021
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="presensi-year">
                            <li id="2021"><a class="dropdown-item" href="#">2021</a></li>
                            <li id="2022"><a class="dropdown-item" href="#">2022</a></li>
                            <li id="2023"><a class="dropdown-item" href="#">2023</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row my-2">
                <table class="table table-log-presensi">
                    <thead class="thead-presensi">
                        <tr>
                            <th scope="col">Tanggal</th>
                            <th scope="col">Masuk</th>
                            <th scope="col">IP Address Masuk</th>
                            <th scope="col">Pulang</th>
                            <th scope="col">IP Address Pulang</th>
                            <th scope="col">Terlambat Masuk</th>
                            <th scope="col">Cepat Pulang</th>
                            <th scope="col">Durasi Bekerja</th>
                            <th scope="col">Status</th>
                            <th scope="col">Fake Locator</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="attendance: ${attendanceList}">
                            <td th:text="${#temporals.format(attendance.dateTime, 'dd-MM-yyyy')}" />
                            <td th:text="${#temporals.format(attendance.dateTime, 'HH:mm:ss')}" />
                            <td th:text="${attendance.ipAddress}" />
                            <td th:text="${#temporals.format(attendance.outDateTime, 'HH:mm:ss')}" />
                            <td th:text="${attendance.outIpAddress}" />
                            <td th:text="${attendance.comeLate}? 'Ya':'Tidak' " />
                            <td th:text="${attendance.goBackEarly}? 'Ya':'Tidak' " />
                            <td th:text="${attendance.workDuration}" />
                            <td th:text="${attendance.outWork}" />
                            <td th:if="${attendance.mockLocation==true}" class="text-danger">On</td>
                            <td th:unless="${attendance.mockLocation==true}">-</td>
                            
                        </tr>
                       
                    </tbody>
                </table>
            </div>
        </div>
        
        <script>
                $(document).ready(function(){
                    $('#dropdown-username').hide();
                    $('#dropdown-username ul').empty();
                    $("input[name='username']").keyup( 
                    function(e) {
                        $('#dropdown-username ul').empty();
                        $('#dropdown-username').hide();
                        if($("input[name='username']").val().length >= 2 && $("input[name='username']").val() != ""){  
                            $.ajax({
                                type: "GET",
                                dataType: "json",
                                url: "/absence/find-user-byname",
                                data:'username='+$("input[name='username']").val(),
                                success: function(data){
                                    console.log("JSON Parse: " + JSON.stringify(data));
                                    var selOpts = "";
                                    if(data!=null && data.length!=0){
                                    $.each(data, function(k, v){
                                        var value = data[k].username;
                                        var text = data[k].name;
                                        selOpts += '<li><a href=\'#\' class=\'username-list\' title="'+text+'">'+text+'</a></li>';
                                    });
                                    $('#dropdown-username ul').append(selOpts);
                                    $('#dropdown-username').show();
                                    //$('#opt-username > option').show();
                                    }                                    
                                    
                                }
                            });
                        }
                    });

                    $('#opt-username').click(
                        function(e){
                            $('#input-search').html($('#opt-username option').text());
                            $("input[name='username']").val($('#opt-username option').val());
                            $(this).hide();
                        }
                    );

                    $('ul#list-username').click(
                        function(e){
                            $('#dropdown-username').hide();
                            $("input[name='username']").val($('ul#list-username li a').attr("title"));
                        }
                    );
        
                    $("#presensi-month li").click(function(){
                        var month = $(this).attr('id') ;
                        $('#month-button').text($(this).find('a').text());
                        $("#month-button").prop('value', month);
                    });
        
                    $("#presensi-year li").click(function(){
                        var year = $(this).attr('id') ;
                        $('#year-button').text($(this).find('a').text());
                        $("#year-button").prop('value', year);
                    });
                    
                   $("#btn-search").click(function(e){
                        var username = $('#input-search').val();
                        var month = $("#month-button").val();
                        var year = $("#year-button").val();
                        $.ajax({
                            type: "POST",
                            url: "/absence-filter",
                            data:{username: username, month: month, year: year},
                            success: function(data){
                                console.log(data);
                               $('.table-log-presensi').html($(data).find('.table-log-presensi'));
                            },
                            error: function(xhr, status, error){
                                alert(error);
                            }
                        });
                        e.preventDefault();
                    });
            });
            
            </script> 
    </div>
     
</body>

</html>